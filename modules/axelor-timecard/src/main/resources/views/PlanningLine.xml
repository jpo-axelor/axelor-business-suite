<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <grid name="planning-line-grid" title="Planning lines" model="com.axelor.apps.timecard.db.PlanningLine">
        <field name="project"/>
        <field name="employee"/>
        <field name="startTime"/>
        <field name="endTime"/>
        <field name="frequency"/>
    </grid>

    <form name="planning-line-form" title="Planning line" model="com.axelor.apps.timecard.db.PlanningLine" width="large"
          onNew="action-planning-line-record-set-defaults,action-planning-line-record-default-frequency"
          onSave="save,action-planningline-method-compute-monthly-hours">
        <panel>
            <field name="project" domain="self.statusSelect = 2 AND self.isSite = true" canEdit="false" grid-view="project-grid" form-view="project-form"/>
            <field name="employee" canEdit="false" grid-view="employee-grid" form-view="employee-form"/>
            <field name="startTime" colSpan="3" validIf="startTime &lt; endTime"/>
            <field name="endTime" colSpan="3" validIf="startTime &lt; endTime"/>
            <field name="frequency" showIf="$readonly()" hidden="true" grid-view="frequency-grid" form-view="frequency-form"/>
            <field name="frequency" canEdit="false" canRemove="false" canSelect="false" canView="false" showTitle="false" showIf="!$readonly()" hidden="true" colSpan="12">
                <editor>
                    <panel title="Frequency type" colSpan="12">
                        <field name="frequencyTypeSelect"/>
                        <panel>
                            <field name="everyNWeeks" showIf="frequencyTypeSelect == 'everyNWeeks'" hidden="true" colSpan="12"/>
                            <field name="first" showIf="frequencyTypeSelect == 'monthDays'" hidden="true" colSpan="2"/>
                            <field name="second" showIf="frequencyTypeSelect == 'monthDays'" hidden="true" colSpan="2"/>
                            <field name="third" showIf="frequencyTypeSelect == 'monthDays'" hidden="true" colSpan="2"/>
                            <field name="fourth" showIf="frequencyTypeSelect == 'monthDays'" hidden="true" colSpan="2"/>
                            <field name="last" showIf="frequencyTypeSelect == 'monthDays'" hidden="true" colSpan="2"/>
                        </panel>
                    </panel>

                    <panel title="Days" colSpan="12">
                        <panel colSpan="3">
                            <field name="monday"/>
                            <field name="tuesday"/>
                        </panel>
                        <panel colSpan="3">
                            <field name="wednesday"/>
                            <field name="thursday"/>
                        </panel>
                        <panel colSpan="3">
                            <field name="friday"/>
                            <field name="saturday"/>
                        </panel>
                        <panel colSpan="3">
                            <field name="sunday"/>
                        </panel>
                    </panel>

                    <panel title="Months" colSpan="12" itemSpan="2">
                        <field name="january"/>
                        <field name="february"/>
                        <field name="march"/>
                        <field name="april"/>
                        <field name="may"/>
                        <field name="june"/>
                        <field name="july"/>
                        <field name="august"/>
                        <field name="september"/>
                        <field name="october"/>
                        <field name="november"/>
                        <field name="december"/>
                    </panel>
                </editor>
            </field>

            <field name="description" colSpan="12"/>
        </panel>

        <panel showIf="$readonly()">
            <field name="monthlyHours"/>
        </panel>
        
        <panel-mail>
    		<mail-messages limit="4" />
    		<mail-followers />
  		</panel-mail>
    </form>

    <action-record name="action-planning-line-record-set-defaults" model="com.axelor.apps.timecard.db.PlanningLine">
        <field name="project" expr="eval: __repo__(Project).find(_projectId)" if="_projectId"/>
        <field name="employee" expr="eval: __repo__(Employee).find(_employeeId)" if="_employeeId"/>
    </action-record>

    <action-record name="action-planning-line-record-default-frequency" model="com.axelor.apps.timecard.db.PlanningLine">
        <field name="frequency" expr="eval: new com.axelor.apps.timecard.db.Frequency()"/>
    </action-record>

    <action-method name="action-planningline-method-compute-monthly-hours">
        <call class="com.axelor.apps.timecard.web.PlanningLineController" method="computeMonthlyHours"/>
    </action-method>

</object-views>
