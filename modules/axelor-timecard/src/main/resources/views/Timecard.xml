<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <grid name="timecard-grid" title="Timecards" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect"/>
        <field name="company"/>
        <field name="employee"/>
        <field name="fromDate"/>
        <field name="toDate"/>
    </grid>

    <form name="timecard-form" title="Timecard" model="com.axelor.apps.timecard.db.Timecard" width="large">
        <toolbar>
            <button name="computeHours" title="Compute hours" onClick="save,action-timecard-method-compute-hours"/>
        </toolbar>

        <menubar>
            <menu title="Tools" icon="fa-wrench">
                <item title="Generate substitution lines" action="save,action-timecard-view-open-substitution-wizard" readonlyIf="!id"/>
                <item title="Generate timecard lines" action="save,action-timecard-method-generate-timecard-lines"/>
                <item title="Show calendar" action="save,action-timecard-view-show-calendar"/>
            </menu>
        </menubar>

        <panel>
            <field name="statusSelect" widget="NavSelect" showTitle="false" colSpan="8"/>
            <panel colSpan="4" stacked="true">
                <button name="sendBtn" title="Send" onClick="action-timecard-group-send"/>
                <button name="validateBtn" title="Validate" onClick="action-timecard-group-validate"/>
                <button name="cancelBtn" title="Cancel" onClick="action-timecard-group-cancel"/>
                <button name="refuseBtn" title="Refuse" onClick="action-timecard-group-refuse"/>
                <button name="closeBtn" title="Close" showIf="statusSelect == 3" onClick="action-timecard-group-close"/>
            </panel>
        </panel>

        <panel>
            <field name="company" colSpan="4" grid-view="company-grid" form-view="company-form"/>
            <field name="employee" colSpan="4" grid-view="employee-grid" form-view="employee-form"/>
            <field name="employee.mainEmploymentContract.monthlyWage" readonly="true" colSpan="4"/>

            <field name="period" onChange="action-timecard-record-set-dates" domain="self.year.company = :company AND self.year.typeSelect = 2 AND self.statusSelect = 1" colSpan="4"/>
            <field name="fromDate" readonly="true" colSpan="4"/>
            <field name="toDate" readonly="true" colSpan="4"/>
        </panel>

        <panel>
            <field name="complementaryHours" colSpan="3"/>
            <field name="complementOfHours" colSpan="3"/>
            <field name="supplementaryHours" colSpan="3"/>
            <field name="nightHours" colSpan="3"/>

            <panel-related field="weeklyHoursList" colSpan="12" readonly="true" grid-view="weekly-hours-grid" form-view="weekly-hours-form"/>
        </panel>


        <panel-related field="timecardLineList" grid-view="timecard-line-grid" form-view="timecard-line-form"/>

        <panel>
            <field name="validatedBy" colSpan="3"/>
            <field name="validationDate" colSpan="3"/>
            <field name="refusedBy" colSpan="3"/>
            <field name="refusalDate" colSpan="3"/>
            <field name="groundForRefusal"/>
            <field name="payrollPreparationComment"/>
        </panel>

        <panel-mail>
            <mail-messages limit="4"/>
            <mail-followers/>
        </panel-mail>
    </form>

    <action-method name="action-timecard-method-generate-timecard-lines">
        <call class="com.axelor.apps.timecard.web.TimecardController" method="generateTimecardLines"/>
    </action-method>

    <action-method name="action-timecard-method-compute-hours">
        <call class="com.axelor.apps.timecard.web.TimecardController" method="computeHours"/>
    </action-method>

    <action-view name="action-timecard-view-show-calendar" title="Timecard - ${employee.name}" model="com.axelor.apps.timecard.db.TimecardLine">
        <view type="calendar" name="timecard-line-calendar"/>
        <domain>self.timecard.id = :_id</domain>
        <context name="calendarDate" expr="eval: timecardLineList.sort{ it.date }[0]?.getDate()"/>
        <context name="_projectId" expr="eval: project?.id"/>
        <context name="_employeeId" expr="eval: employee?.id"/>
    </action-view>

    <action-view name="action-timecard-view-open-substitution-wizard" title="Substitution assistant" model="com.axelor.apps.base.db.Wizard">
        <view type="form" name="timecard-line-substitution-wizard-form"/>
        <view-param name="popup" value="reload"/>
        <view-param name="popup-save" value="false"/>
        <view-param name="show-toolbar" value="false"/>
        <view-param name="show-confirm" value="false"/>
        <context name="_timecardId" expr="eval: __self__.id"/>
    </action-view>


    <action-group name="action-timecard-group-send">
        <action name="action-timecard-record-send"/>
    </action-group>

    <action-record name="action-timecard-record-send" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect" expr="eval: 2"/>
    </action-record>


    <action-group name="action-timecard-group-validate">
        <action name="action-timecard-method-validate"/>
    </action-group>

    <action-method name="action-timecard-method-validate">
        <call class="com.axelor.apps.timecard.web.TimecardController" method="validate"/>
    </action-method>

    <action-record name="action-timecard-record-validate" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect" expr="eval: 3"/>
    </action-record>


    <action-group name="action-timecard-group-cancel">
        <action name="action-timecard-record-cancel"/>
    </action-group>

    <action-record name="action-timecard-record-cancel" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect" expr="eval: 6"/>
    </action-record>


    <action-group name="action-timecard-group-refuse">
        <action name="action-timecard-record-refuse"/>
    </action-group>

    <action-record name="action-timecard-record-refuse" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect" expr="eval: 5"/>
    </action-record>


    <action-group name="action-timecard-group-close">
        <action name="action-timecard-record-close"/>
    </action-group>

    <action-record name="action-timecard-record-close" model="com.axelor.apps.timecard.db.Timecard">
        <field name="statusSelect" expr="eval: 4"/>
    </action-record>

    <action-record name="action-timecard-record-set-dates" model="com.axelor.apps.timecard.db.Timecard">
        <field name="fromDate" expr="eval: period?.fromDate"/>
        <field name="toDate" expr="eval: period?.toDate"/>
    </action-record>

</object-views>
