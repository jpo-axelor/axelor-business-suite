<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <form name="time-card-line-form" id="tn-time-card-line-form" title="Ligne de pointage" model="com.axelor.apps.timecard.db.TimecardLine" width="large"
          onNew="action-time-card-line-method-set-defaults,action-time-card-line-record-compute-duration"
          onLoad="action-time-card-line-method-get-substitutions-duration">
        <panel readonlyIf="typeSelect == 'contractual'">
            <field name="typeSelect" selection-in="['extra', 'absence']"/>
            <field name="isContractual" showIf="typeSelect == 'extra' &amp;&amp; isSubstitution"/>
            <field name="project" onSelect="action-time-card-line-attrs-set-project-domain" canSelect="true" canEdit="false"/>
            <field name="employee"/>
            <field name="product"/>
            <spacer/>
            <field name="weekDay" colSpan="2"/>
            <field name="date" onChange="action-time-card-line-record-get-week-day" colSpan="2"/>
            <field name="startTime" colSpan="2" onChange="action-time-card-line-record-compute-duration,action-time-card-line-method-compute-night-hours" validIf="startTime &lt; endTime"/>
            <field name="endTime" colSpan="2" onChange="action-time-card-line-record-compute-duration,action-time-card-line-method-compute-night-hours" validIf="startTime &lt; endTime"/>
            <field name="duration" colSpan="2"/>
            <field name="durationNight" colSpan="2"/>
            <spacer/>
            <field name="leaveLine" onSelect="action-time-card-line-attrs-leaveline-domain" hidden="true" showIf="typeSelect == 'absence'" grid-view="leave-line-grid" form-view="leave-line-form"/>
            <field name="leaveRequest" showIf="leaveRequest &amp;&amp; typeSelect == 'absence'" grid-view="leave-request-grid" form-view="leave-request-form"/>
            <field name="comments" colSpan="12" widget="html"/>
            <spacer/>
            <panel title="Remplacements" showIf="(typeSelect == 'extra' &amp;&amp; isSubstitution) || typeSelect == 'absence'" colSpan="12">
                <field name="absenceTimecardLine" showIf="typeSelect == 'extra' &amp;&amp; isSubstitution" grid-view="time-card-line-grid" form-view="time-card-line-form"/>
                <spacer/>
                <field name="totalSubstitutionHours" showIf="typeSelect == 'absence'"/>
                <panel-related field="substitutionTimecardLineList" readonly="true" showIf="typeSelect == 'absence'" canNew="false" colSpan="12" grid-view="time-card-line-grid" form-view="time-card-line-form"/>
                <button name="addSubstitution" title="Add a substitution" css="btn-custom text-left" icon="fa-plus" onClick="save,action-time-card-line-view-add-substitution" showIf="typeSelect == 'absence'"/>

                <field name="isSubstitution" hidden="true"/>
            </panel>
        </panel>
    </form>

    <action-attrs name="action-time-card-line-attrs-set-project-domain">
        <attribute for="project" name="domain" expr="eval: &quot;self.statusSelect = 2 AND self.sector.id IN (${(employee?.sectorSet?.collect([0], { it.id })).join(',')})&quot;"/>
    </action-attrs>

</object-views>
